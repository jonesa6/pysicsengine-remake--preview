// Add your code here
namespace scene.systemMenu_ {
    export const CARD_NORMAL = img`
        . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . .
        . 1 1 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 1 1 .
        1 1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1
        1 1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1 1
        . 1 1 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 1 1 .
        . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . .
    `;
    export const CARD_SELECTED = img`
        . . 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 . .
        . 2 2 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 2 2 .
        2 2 3 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 2 2
        2 3 2 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2
        2 3 2 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 3 2
        2 2 3 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 2 2
        . 2 2 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 2 2 .
        . . 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 . .
    `;
    export const CARD_ACTIVE = img`
        . . 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 . .
        . 4 4 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 4 4 .
        4 4 3 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 3 4 4
        4 3 4 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 3 4
        4 3 4 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 4 4 3 4
        4 4 3 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 3 4 4
        . 4 4 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 4 4 .
        . . 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 . .
    `;
    export const VOLUME_UP_ICON = img`
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . c c c b b . . . . . . . . . 6 6 7 . . . . .
        . . . . . . . . . c b 1 1 d b b . . . . . . . . 6 6 6 6 . . . .
        . . . . . . . . c d 1 d c b d b . . . . . 6 7 . . 6 6 6 7 . . .
        . . . . . c c c b 1 d c c c b d b . . . . 6 6 6 . 7 6 6 6 . . .
        . . c c c c b c 1 1 b c c c c d b . . . . 7 6 6 7 . 6 6 6 7 . .
        . c b d c b 1 b 1 1 c c c c c b c . d 7 . . 6 6 6 . 7 6 6 6 . .
        . c d b b 1 1 b 1 d c d b c c b c . 7 6 7 . 7 6 6 . 7 6 6 6 . .
        . f d b b d 1 b d d b d d c c b c . . 6 6 . 7 6 6 . 7 6 6 6 . .
        . f d b b d d b d d b d b c f b c . . 6 6 . 7 6 6 . 7 6 6 6 . .
        . f d b b b d b d d f b c f f b c . 7 6 7 . 7 6 6 . 7 6 6 6 . .
        . f b d c b b b d d f f f f f b c . d 7 . . 6 6 6 . 7 6 6 6 . .
        . . f f f f b c d d c f f f c d b . . . . 7 6 6 7 . 6 6 6 7 . .
        . . . . . f f f b 1 d f f f b d b . . . . 6 6 6 . 7 6 6 6 . . .
        . . . . . . . . c d 1 d c b d b . . . . . 6 7 . . 6 6 6 7 . . .
        . . . . . . . . . c b 1 1 d b b . . . . . . . . 6 6 6 6 . . . .
        . . . . . . . . . . c c c c b . . . . . . . . . 6 6 7 . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    `;
    export const BRIGHTNESS_DOWN_ICON = img`
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . b b b . . . . . . . . . . . . . .
        . . . . . . . . . . . b . . . 4 5 4 . . . b . . . . . . . . . .
        . . . . . . . . . . b 5 4 . . . 4 . . . 4 5 b . . . . . . . . .
        . . . . . . . . . b 5 5 4 . . . . . . . 4 5 5 b . . . . . . . .
        . . . . . . . . . . b 4 . . . 4 4 4 . . . 4 4 . . . . . . . . .
        . . . . . . . . . . . . . 4 4 5 5 5 4 4 . . . . . . . . . . . .
        . . . . . . . . . . . . . 4 5 5 1 1 5 4 . . . . . . . . . . . .
        . . . . . . . . b 4 . . 4 d 5 5 1 1 5 d 4 . . 4 b . . . . . . .
        . . . . . . . . b 5 4 . b d d 5 5 5 d d b . 4 5 b . . . . . . .
        . . . . . . . . b 4 . . b d d d d d d d b . . 4 b . . . . . . .
        . . . . . . . . . . . . . b d d d d d b . . . . . . . . . . . .
        . . . . . . . . . . . . . b b d d d b b . . . . . . . . . . . .
        . . . . . . . . . . 4 4 . . . b b b . . . 4 4 . . . . . . . . .
        . . . . . . . . . b 5 5 4 . . . . . . . 4 5 5 b . . . . . . . .
        . . . . . . . . . . b 5 4 . . . 4 . . . 4 5 b . . . . . . . . .
        . . . . . . . . . . . b . . . 4 5 4 . . . b . . . . . . . . . .
        . . . . . . . . . . . . . . . b b b . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    `;
    export const CLOSE_MENU_ICON = img`
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . 2 2 . . . . . . . . . . . . . . 2 2 . . . . . . .
        . . . . . . . 2 2 2 . . . . . . . . . . . . 2 2 2 . . . . . . .
        . . . . . . . . 2 2 2 . . . . . . . . . . 2 2 2 . . . . . . . .
        . . . . . . . . . 2 2 2 . . . . . . . . 2 2 2 . . . . . . . . .
        . . . . . . . . . . 2 2 2 . . . . . . 2 2 2 . . . . . . . . . .
        . . . . . . . . . . . 2 2 2 . . . . 2 2 2 . . . . . . . . . . .
        . . . . . . . . . . . . 2 2 2 . . 2 2 2 . . . . . . . . . . . .
        . . . . . . . . . . . . . 2 2 2 2 2 2 . . . . . . . . . . . . .
        . . . . . . . . . . . . . . 2 2 2 2 . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . 2 2 2 2 . . . . . . . . . . . . . .
        . . . . . . . . . . . . . 2 2 2 2 2 2 . . . . . . . . . . . . .
        . . . . . . . . . . . . 2 2 2 . . 2 2 2 . . . . . . . . . . . .
        . . . . . . . . . . . 2 2 2 . . . . 2 2 2 . . . . . . . . . . .
        . . . . . . . . . . 2 2 2 . . . . . . 2 2 2 . . . . . . . . . .
        . . . . . . . . . 2 2 2 . . . . . . . . 2 2 2 . . . . . . . . .
        . . . . . . . . 2 2 2 . . . . . . . . . . 2 2 2 . . . . . . . .
        . . . . . . . 2 2 2 . . . . . . . . . . . . 2 2 2 . . . . . . .
        . . . . . . . 2 2 . . . . . . . . . . . . . . 2 2 . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    `;
    export const VOLUME_DOWN_ICON = img`
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . c c c b b . . . . . . . . . . . .
        . . . . . . . . . . . . . . c b 1 1 d b b . . . . . . . . . . .
        . . . . . . . . . . . . . c d 1 d c b d b . . . . . . . . . . .
        . . . . . . . . . . c c c b 1 d c c c b d b . . . . . . . . . .
        . . . . . . . c c c c b c 1 1 b c c c c d b . . . . . . . . . .
        . . . . . . c b d c b 1 b 1 1 c c c c c b c . d 7 . . . . . . .
        . . . . . . c d b b 1 1 b 1 d c d b c c b c . 7 6 7 . . . . . .
        . . . . . . f d b b d 1 b d d b d d c c b c . . 6 6 . . . . . .
        . . . . . . f d b b d d b d d b d b c f b c . . 6 6 . . . . . .
        . . . . . . f d b b b d b d d f b c f f b c . 7 6 7 . . . . . .
        . . . . . . f b d c b b b d d f f f f f b c . d 7 . . . . . . .
        . . . . . . . f f f f b c d d c f f f c d b . . . . . . . . . .
        . . . . . . . . . . f f f b 1 d f f f b d b . . . . . . . . . .
        . . . . . . . . . . . . . c d 1 d c b d b . . . . . . . . . . .
        . . . . . . . . . . . . . . c b 1 1 d b b . . . . . . . . . . .
        . . . . . . . . . . . . . . . c c c c b . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    `;
    export const SLEEP_ICON = img`
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . b b b b b b . . . . . . . . . . . . .
        . . . . . . . . . . . b b d 5 5 5 5 d c c . . . . . . . . . . .
        . . . . . . . . . . b d 5 5 5 b c c c c c c . . . . . . . . . .
        . . . . . . . . . b 5 5 5 5 c c c c c c c c c . . . . . . . . .
        . . . . . . . . b d 5 5 5 b c c c c c d c c c c . . . . . . . .
        . . . . . . . . b 5 5 5 5 c c c c c b 5 b c c c . . . . . . . .
        . . . . . . . b d 5 5 5 5 c c c c d 5 5 5 d c d c . . . . . . .
        . . . . . . . b 5 5 5 5 5 c c c c b 5 5 5 b c d c . . . . . . .
        . . . . . . . c 5 5 5 5 5 c c c c c 5 b 5 c c d c . . . . . . .
        . . . . . . . c 5 5 5 5 5 b c c c c c c c c b d c . . . . . . .
        . . . . . . . c d 5 5 5 5 5 c c c c c c c c d d c . . . . . . .
        . . . . . . . c d d 5 5 5 d d b c c c c b d d d c . . . . . . .
        . . . . . . . . c d d d d d d d d d d d d d d c . . . . . . . .
        . . . . . . . . c d d d d d d d d d d d d d d c . . . . . . . .
        . . . . . . . . . c 9 9 d d d d d d d d d 9 c . . . . . . . . .
        . . . . . . . . . . b 9 9 9 d d d d d 9 9 c . . . . . . . . . .
        . . . . . . . . . . . b b 9 9 9 9 9 9 c c . . . . . . . . . . .
        . . . . . . . . . . . . . b b b b c c . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    `;
    export const CONSOLE_ICON = img`
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . b b b b b b b b b b b c c . . . . . . . . .
        . . . . . . . . . b 1 d d d d d d d d d d 1 b c . . . . . . . .
        . . . . . . . . b 1 1 1 1 1 1 1 1 1 1 1 1 b b c . . . . . . . .
        . . . . . . . . b d b c c c c c c c c c b b b c . . . . . . . .
        . . . . . . . . b d c 6 6 6 6 6 6 6 6 6 c b b c . . . . . . . .
        . . . . . . . . b d c 6 1 6 6 6 6 6 6 6 c b b c . . . . . . . .
        . . . . . . . . b d c 6 6 1 6 6 6 6 6 6 c b b c . . . . . . . .
        . . . . . . . . b d c 6 6 6 1 6 6 6 6 6 c b b c . . . . . . . .
        . . . . . . . . b d c 6 6 1 6 6 6 6 6 6 c b b c . . . . . . . .
        . . . . . . . . b d c 6 1 6 6 6 1 1 1 6 c b b c . . . . . . . .
        . . . . . . . . b d c 6 6 6 6 6 6 6 6 6 c b b c . . . . . . . .
        . . . . . . . . b d c c c c c c c c c c c b b c . . . . . . . .
        . . . . . . . . c b b b b b b b b b b b b b c . . . . . . . . .
        . . . . . . . . . c c c c c c c c c c c c c . . . . . . . . . .
        . . . . . . . . . . . . . c c c c c c . . . . . . . . . . . . .
        . . . . . . . . . c c c c b b b b b b c c c c c . . . . . . . .
        . . . . . . . . c 1 1 b 1 1 b 1 1 b 1 1 b d d c . . . . . . . .
        . . . . . . . c d d d d d d d d d d d d d b c . . . . . . . . .
        . . . . . . . c c c c c c c c c c c c c c c . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    `;
    export const BRIGHTNESS_UP_ICON = img`
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . 4 4 . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . 4 5 5 4 . . . . . . . . . . . . . .
        . . . . . . . . 4 4 b . . . b b b b . . . b 4 4 . . . . . . . .
        . . . . . . . 4 5 5 b . . . . . . . . . . b 5 5 4 . . . . . . .
        . . . . . . . 4 5 b . . . . 4 4 4 4 . . . . b 5 4 . . . . . . .
        . . . . . . . b b . . . 4 4 5 5 5 5 4 4 . . . b b . . . . . . .
        . . . . . . . . . . . 4 d 5 5 5 5 5 5 d 4 . . . . . . . . . . .
        . . . . . . . . . . 4 d 5 5 5 5 5 1 1 5 d 4 . . . . . . . . . .
        . . . . . . . . . . 4 5 5 5 5 5 5 1 1 5 5 4 . . . . . . . . . .
        . . . . . . 4 b . 4 d 5 5 5 5 5 5 5 5 5 5 d 4 . b 4 . . . . . .
        . . . . . 4 5 b . 4 d 5 5 5 5 5 5 5 5 5 5 d 4 . b 5 4 . . . . .
        . . . . . 4 5 b . b d 5 5 5 5 5 5 5 5 5 5 d b . b 5 4 . . . . .
        . . . . . . 4 b . b d d 5 5 5 5 5 5 5 5 d d b . b 4 . . . . . .
        . . . . . . . . . . b d d 5 5 5 5 5 5 d d b . . . . . . . . . .
        . . . . . . . . . . b d d d d d d d d d d b . . . . . . . . . .
        . . . . . . . . . . . b d d d d d d d d b . . . . . . . . . . .
        . . . . . . . b b . . . b b d d d d b b . . . b b . . . . . . .
        . . . . . . . 4 5 b . . . . b b b b . . . . b 5 4 . . . . . . .
        . . . . . . . 4 5 5 b . . . . . . . . . . b 5 5 4 . . . . . . .
        . . . . . . . . 4 4 b . . . b b b b . . . b 4 4 . . . . . . . .
        . . . . . . . . . . . . . . 4 5 5 4 . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . 4 4 . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    `;
    export const STATS_ICON = img`
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . b b b b . . . . . . . . . . . . . . . . . . . . .
        . . . . . . b 5 5 b b . b b b b b b . . . . . . . . . . . . . .
        . . . . . . b 5 b d c c b d d d 5 5 b b . . . . . . . . . . . .
        . . . . . . b b d b c d d b b b b d 5 5 b . . . . . . . . . . .
        . . . . . . b b b c d d b 1 1 1 1 1 b d 5 b . . . . . . . . . .
        . . . . . . . . c b d b 1 1 1 1 1 1 1 d b 5 b . . . . . . . . .
        . . . . . . . . b 5 b d 1 1 b 1 1 1 1 1 d d 5 b . . . . . . . .
        . . . . . . . b b 5 b 1 1 1 d b 1 1 b 1 1 b 5 b . . . . . . . .
        . . . . . . . b b 5 b 1 1 1 1 b b 1 b 9 9 1 d 5 b . . . . . . .
        . . . . . . . b b 5 b 1 1 1 1 1 b b b 9 9 9 b 5 b . . . . . . .
        . . . . . . . b b 5 5 d 1 1 1 9 9 b b 9 9 9 b 5 b . . . . . . .
        . . . . . . . b d b 5 b 1 1 9 9 9 9 9 9 9 9 c 5 b . . . . . . .
        . . . . . . . b d b 5 5 b 1 9 9 9 9 9 9 9 d b 5 b . . . . . . .
        . . . . . . . . b d b 5 5 b 9 9 9 9 9 9 9 c 5 d . . . . . . . .
        . . . . . . . . c d d b 5 5 b b 9 9 9 d c b 5 b . . . . . . . .
        . . . . . . . . . c d d b 5 5 5 b c c b 5 5 b . . . . . . . . .
        . . . . . . . . . . c b b b d 5 5 5 5 5 d b . . . . . . . . . .
        . . . . . . . . . . . c c b b b b b b b b . . . . . . . . . . .
        . . . . . . . . . . . . . c c c c c c . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    `;
    let instance: PauseMenu;
    let customMenuOptions: MenuOption[];

    export enum CardState {
        Selected,
        Active,
        None
    }

    export interface MenuTheme {
        cardSpacing: number;
        cardWidth: number;
        cardsPerRow: number;
        padding: number;
        cardsTop: number;
        infoTop: number;

        // "PAUSED"
        headerText: string;

        headerFont: image.Font;
        infoFont: image.Font;

        selectedCard: Image;
        activeCard: Image;
        basicCard: Image;
    }

    export class MenuOption {
        protected card: Sprite;
        protected icon: Sprite;

        protected top: number;
        protected state: CardState;

        protected theme: MenuTheme;

        constructor(protected iconImage: Image, public getText: () => string, public action: () => void) {
        }

        show() {
            this.card = sprites.create(this.theme ? this.theme.basicCard : CARD_NORMAL);
            this.card.z = 1;

            this.icon = sprites.create(this.iconImage);
            this.icon.z = 2;

            this.state = CardState.None;
        }

        position(left: number, top: number) {
            this.top = top;

            this.card.left = left;
            this.card.top = top;

            this.icon.x = this.card.x;
            this.icon.y = this.card.y;
        }

        setOffset(offset: number) {
            this.card.top = this.top + offset;
            this.icon.y = this.card.y;
        }

        setTheme(theme: MenuTheme) {
            this.theme = theme;
            this.updateCard();
        }

        setState(state: CardState) {
            if (this.state === state) return;
            this.state = state;
            this.updateCard();
        }

        dispose() {
            if (this.card) {
                this.card.destroy();
                this.icon.destroy();
                this.card = undefined;
                this.icon = undefined;
            }
        }

        protected updateCard() {
            if (!this.theme) return;
            switch (this.state) {
                case CardState.None: this.card.setImage(this.theme.basicCard); break;
                case CardState.Selected: this.card.setImage(this.theme.selectedCard); break;
                case CardState.Active: this.card.setImage(this.theme.activeCard); break;
            }

            // Center the icon
            this.icon.x = this.card.x;
            this.icon.y = this.card.y;
        }
    }

    export class PauseMenu {
        protected options: MenuOption[];
        protected theme: MenuTheme;

        // Index of selected card
        protected selection: number;

        // The row that is currently at the top of the screen
        protected scrollRow: number;

        // The pixel offset for the scrollRow
        protected scrollTarget: number;

        // The current pixel offset of the scroll (might be animating)
        protected scrollOffset: number;

        constructor(protected generator: () => MenuOption[], theme?: MenuTheme) {
            this.theme = theme || buildMenuTheme(CARD_NORMAL.width, 3);
            this.scrollRow = 0;
            this.scrollOffset = 0;
            this.scrollTarget = 0;
        }

        show() {
            this.options = this.generator();
            this.selection = 0;

            let current: MenuOption;
            for (let i = 0; i < this.options.length; i++) {
                current = this.options[i];
                current.show();
                current.setTheme(this.theme);
                current.position(
                    this.theme.padding + (i % this.theme.cardsPerRow) * (this.theme.cardWidth + this.theme.cardSpacing),
                    this.theme.cardsTop + (Math.idiv(i, this.theme.cardsPerRow) * (this.theme.cardWidth + this.theme.cardSpacing))
                );
            }

            controller._setUserEventsEnabled(false);

            controller.A.onEvent(SYSTEM_KEY_DOWN, () => {
                if (!this.options || !this.options[this.selection]) return;
                this.options[this.selection].setState(CardState.Active);
            });

            controller.A.onEvent(SYSTEM_KEY_UP, () => {
                if (!this.options || !this.options[this.selection]) return;
                this.options[this.selection].setState(CardState.Selected);
                control.runInParallel(this.options[this.selection].action)
            });

            controller.B.onEvent(SYSTEM_KEY_DOWN, () => {
                closeMenu();
            });

            controller.menu.onEvent(SYSTEM_KEY_DOWN, () => {
                closeMenu();
            });

            controller.up.onEvent(SYSTEM_KEY_DOWN, () => {
                this.setSelection(Math.max(0, this.selection - this.theme.cardsPerRow));
            });

            controller.left.onEvent(SYSTEM_KEY_DOWN, () => {
                this.setSelection(Math.max(0, this.selection - 1));
            });

            controller.down.onEvent(SYSTEM_KEY_DOWN, () => {
                this.setSelection(Math.min(this.options.length - 1, this.selection + this.theme.cardsPerRow));
            });

            controller.right.onEvent(SYSTEM_KEY_DOWN, () => {
                this.setSelection(Math.min(this.options.length - 1, this.selection + 1));
            });

            game.onShade(() => {
                this.onUpdate();
                this.drawText();
            });

            this.setSelection(0);
        }

        onUpdate() {
            if (power.indeepSleep) {
                this.dispose()    
            }
            // Should probably factor out this animation
            let t = control.millis() / 250;
            for (let i = 0; i < this.options.length; i++) {
                this.options[i].setOffset(2 * Math.sin(t - (i % this.theme.cardsPerRow) * (Math.PI / 2)))
            }

            const dt = game.currentScene().eventContext.deltaTime;
            if (this.scrollOffset < this.scrollTarget) {
                this.scrollOffset += dt * 100;
            }
            else if (this.scrollOffset > this.scrollTarget) {
                this.scrollOffset -= dt * 100;
            }
            else {
                return;
            }

            if (Math.abs(this.scrollOffset - this.scrollTarget) < 2) {
                this.scrollOffset = this.scrollTarget;
            }

            game.currentScene().camera.offsetY = this.scrollOffset;
        }

        setSelection(selection: number) {
            if (!this.options) return;

            if (this.options[this.selection]) {
                this.options[this.selection].setState(CardState.None);
            }

            this.selection = selection;

            if (this.options[this.selection]) {
                this.options[this.selection].setState(controller.A.isPressed() ? CardState.Active : CardState.Selected);
            }

            this.updateScrollTarget();
        }

        drawText() {
            if (!this.options) return;

            // Black bar to draw the header on
            screen.fillRect(0, 0, screen.width, this.theme.cardsTop - 2, 15);

            // Header text
            screen.printCenter(this.theme.headerText, 2, 1, this.theme.headerFont);

            // Black bar for the info box to draw on
            screen.fillRect(0, this.theme.infoTop - 3, screen.width, screen.height - this.theme.infoTop + 6, 15);

            // White info box
            screen.fillRect(this.theme.padding, this.theme.infoTop, screen.width - (this.theme.padding << 1), this.theme.infoFont.charHeight + 1, 1);

            // Info text
            screen.printCenter(this.options[this.selection].getText(), this.theme.infoTop + 1, 15, this.theme.infoFont);
        }

        dispose() {
            if (this.options) {
                this.options.forEach(o => o.dispose());
                this.options = undefined;
            }
        }

        protected updateScrollTarget() {
            const row = Math.idiv(this.selection, this.theme.cardsPerRow);

            // FIXME: Assumes that there are always two rows on screen
            if (row === this.scrollRow || row - 1 === this.scrollRow) return;

            if (row > this.scrollRow) this.scrollRow++;
            else this.scrollRow--;

            this.scrollTarget = this.scrollRow * (this.theme.cardSpacing + this.theme.cardWidth);
        }
    }

    // we intentionally only save volume when the user explicitly adjusts it
    // we don't want to save it when adjusted programatically, because it could for example changing in a loop
    function setVolume(newVolume: number) {
        music.setVolume(newVolume);
        music.playTone(440, 500);
        settings.writeNumber("#volume", newVolume)
    }

    function volumeUp() {
        const v = music.volume();
        const remainder = v % 32;
        const newVolume = v + 32 - remainder;
        setVolume(newVolume);
    }

    function volumeDown() {
        const v = music.volume();
        const remainder = v % 32;
        const newVolume = v - (remainder ? remainder : 32);
        setVolume(newVolume);
    }

    function brightnessUp() {
        setScreenBrightness(screen.brightness() + 5);
    }

    function brightnessDown() {
        setScreenBrightness(screen.brightness() - 5);
    }

    function setScreenBrightness(b: number) {
        screen.setBrightness(b);
        // we intentionally only save brightness when the user explicitly adjusts it
        // we don't want to save it when adjusted programatically, because it could for example changing in a loop
        settings.writeNumber("#brightness", screen.brightness())
    }

    function toggleStats() {
        game.stats = !game.stats;
        if (!game.stats && control.EventContext.onStats) {
            control.EventContext.onStats("");
        }
    }

    function toggleConsole() {
        if (game.consoleOverlay.isVisible())
            game.consoleOverlay.setVisible(false);
        else {
            game.consoleOverlay.setVisible(true);
            console.log("console");
        }
    }

    function sleep() {
        power.deepSleep();
    }

    export function closeMenu() {
        if (instance) {
            instance.dispose();
            instance = undefined;
            controller._setUserEventsEnabled(true);
            game.popScene();
        }
    }

    //% shim=pxt::setScreenBrightnessSupported
    function setScreenBrightnessSupported() {
        return 0 // default to no, in simulator
    }

    export function buildOptionList(): MenuOption[] {
        let options: MenuOption[] = [];

        options.push(new MenuOption(VOLUME_DOWN_ICON, () => `VOLUME DOWN (${music.volume()})`, volumeDown));
        options.push(new MenuOption(VOLUME_UP_ICON, () => `VOLUME UP (${music.volume()})`, volumeUp));
        if (setScreenBrightnessSupported()) {
            options.push(new MenuOption(BRIGHTNESS_DOWN_ICON, () => `BRIGHTNESS DOWN (${screen.brightness()})`, brightnessDown));
            options.push(new MenuOption(BRIGHTNESS_UP_ICON, () => `BRIGHTNESS UP (${screen.brightness()})`, brightnessUp));
        }
        options.push(new MenuOption(STATS_ICON, () => game.stats ? "HIDE STATS" : "SHOW STATS", toggleStats));
        options.push(new MenuOption(CONSOLE_ICON, () => game.consoleOverlay.isVisible() ? "HIDE CONSOLE" : "SHOW CONSOLE", toggleConsole));
        options.push(new MenuOption(SLEEP_ICON, () => "SLEEP", sleep));

        if (customMenuOptions) {
            options = options.concat(customMenuOptions);
        }

        options.push(new MenuOption(CLOSE_MENU_ICON, () => "CLOSE", closeMenu));

        return options;
    }

    export function buildMenuTheme(cardWidth: number, cardSpacing: number, infoFont?: image.Font, headerFont?: image.Font): MenuTheme {
        const cardsPerRow = Math.idiv(screen.width, cardWidth + cardSpacing);
        infoFont = infoFont || image.font8;
        headerFont = headerFont || image.doubledFont(infoFont);

        return {
            cardSpacing: cardSpacing,
            cardWidth: cardWidth,
            cardsPerRow: cardsPerRow,
            padding: (screen.width - (cardsPerRow * cardWidth + (cardsPerRow - 1) * cardSpacing)) >> 1,
            infoFont: infoFont,
            headerFont: headerFont,
            cardsTop: headerFont.charHeight + 2 + cardSpacing,
            infoTop: screen.height - infoFont.charHeight - 2,
            headerText: "PAUSED",
            selectedCard: CARD_SELECTED,
            activeCard: CARD_ACTIVE,
            basicCard: CARD_NORMAL
        };
    }
    export let inmenu = false
    export let selected = false
    let mySprite:Sprite = null
    function custommenu() {
            if (inmenu) {
                mySprite.setImage(null)
                mySprite.destroy()
                systemMenu_.inmenu = false
                return
            }
            systemMenu_.inmenu = true
            mySprite = sprites.create(img`
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        `, SpriteKind.Player)
            mySprite.image.print("PAUSED", 50, 0, 1, image.font12)
            mySprite.image.print("brightness", 30, 50)
            mySprite.image.drawImage(img`
            4 4 4 4 4 4 4 4 . 4 4 4 4 4 4 4
            4 . . . . . . 4 . 4 . . . . . 4
            4 . . . . . . 4 . 4 . . 2 . . 4
            4 . 2 2 2 2 . 4 . 4 . 2 2 2 . 4
            4 . . . . . . 4 . 4 . . 2 . . 4
            4 . . . . . . 4 . 4 . . . . . 4
            4 . . . . . . 4 . 4 . . . . . 4
            4 4 4 4 4 4 4 4 . 4 4 4 4 4 4 4
        `, 90, 50)
            mySprite.image.print("volume", 30, 60)
            mySprite.image.drawImage(img`
            4 4 4 4 4 4 4 4 . 4 4 4 4 4 4 4
            4 . . . . . . 4 . 4 . . . . . 4
            4 . . . . . . 4 . 4 . . 2 . . 4
            4 . 2 2 2 2 . 4 . 4 . 2 2 2 . 4
            4 . . . . . . 4 . 4 . . 2 . . 4
            4 . . . . . . 4 . 4 . . . . . 4
            4 . . . . . . 4 . 4 . . . . . 4
            4 4 4 4 4 4 4 4 . 4 4 4 4 4 4 4
        `, 90, 60)

            forever(function () {
                if (mySprite) {
                    if (controller.up.isPressed() || controller.down.isPressed()) {
                        selected = !selected
                    }
                    mySprite.image.fillRect(110, 50, 25, 10, 0)
                    mySprite.image.print(screen.brightness().toString(), 110, 50)
                    mySprite.image.fillRect(110, 60, 25, 10, 0)
                    mySprite.image.print(music.volume().toString(), 110, 60)
                    if (!selected) {
                        mySprite.image.drawRect(30, 50, 59, 10, 1)
                        mySprite.image.drawRect(30, 60, 59, 10, 16)
                        if (controller.A.isPressed()) {
                            screen.setBrightness(screen.brightness() + 10)
                        }
                        if (controller.B.isPressed()) {
                            screen.setBrightness(screen.brightness() - 10)
                        }
                    }
                    if (selected) {
                        mySprite.image.drawRect(30, 50, 59, 10, 16)
                        mySprite.image.drawRect(30, 60, 59, 10, 1)
                        if (controller.A.isPressed()) {
                            music.setVolume(music.volume() + 32)
                        }
                        if (controller.B.isPressed()) {
                            music.setVolume(music.volume() - 32)
                        }
                    }
                    pause(100)
                }
            })

    }
    export function addEntry(name: () => string, clickHandler: () => void, icon: Image) {
        if (!customMenuOptions) customMenuOptions = [];
        customMenuOptions.push(new MenuOption(icon, name, clickHandler));
    }

    

    export function showSystemMenu() {
        if (instance||power.indeepSleep) return;
        game.pushScene();
        instance = new PauseMenu(buildOptionList);
        instance.show();
    }

    export function isVisible() {
        return !!instance;
    }

    function initVolume() {
        const vol = settings.readNumber("#volume")
        if (vol !== undefined)
            music.setVolume(vol)
    }

    function initScreen() {
        const brightness = settings.readNumber("#brightness");
        if (brightness !== undefined)
            screen.setBrightness(brightness)
    }

    initVolume()
    initScreen()
    controller.menu.onEvent(ControllerButtonEvent.Pressed, function() {
    if (custommenu) {
    custommenu()
    } else {
    showSystemMenu()
    }
    })
    
}
